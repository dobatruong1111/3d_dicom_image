var f=Object.defineProperty;var I=(t,e,n)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(I(t,typeof e!="symbol"?e+"":e,n),n);import{j as d,e as h,G as l,R as a,m as w,t as g,L as x}from"./index.dc3130ce.js";import{T as E}from"./0f92dcbd.js";const{DicomMetaDictionary:y,DicomMessage:b}=d.exports.dcmjs.data;function A(t){const e=[],n=`${t.PatientName} (${t.PatientSex}, #${t.PatientID})`;e.push(m("Patient",n));const s=t.StudyDescription;e.push(m("Study",s));const r=`${t.SeriesDescription} (#${t.SeriesNumber})`;e.push(m("Series",r));const i=`${t.Manufacturer} (${t.ManufacturerModelName}, #${t.DeviceSerialNumber})`;e.push(m("Manufacturer",i));const o={CompletionFlag:"Completion flag",VerificationFlag:"Verification flag"};Object.keys(o).forEach(u=>{if(!t[u])return;const S=m(o[u],t[u]);e.push(S)});const c=`${t.ContentDate} ${t.ContentTime}`;return e.push(m("Content Date/Time",c)),e.push(),a.createElement("div",null,a.createElement("div",{className:"HorizontalDivider"}),a.createElement("div",{className:"w-100 MainTitle"},a.createElement("h1",{className:"MainTitleText"},"Study Summary")),e)}const D=(t,e,n=1)=>{let s;if(e.ConceptNameCodeSequence){const{CodeMeaning:i,CodeValue:o,CodingSchemeDesignator:c}=e.ConceptNameCodeSequence;s=`${i} (${o} - ${c})`}const r=[];if(s){const i=`h${Math.min(n,5)}`;r.push(a.createElement("div",{key:s},a.createElement("div",{className:"HorizontalDivider p-2"}),a.createElement("div",{className:"w-100 MainTitle"},a.createElement(i,{className:"MainTitleText"},s))))}return Object.keys(e).forEach(i=>{const o=e[i];let c;o instanceof Object?c=D(i,o,n+1):c=a.createElement("div",{key:`${i}-${e[i]}`},a.createElement("b",null,i),": \xA0",e[i]),r.push(c)}),a.createElement("div",{key:t},r)};function m(t,e){return a.createElement("div",{key:t},a.createElement("b",null,t),": \xA0",e)}class v extends h.exports.Component{constructor(){super(...arguments);p(this,"state",{content:null,error:null});p(this,"setViewportActiveHandler",()=>{const{setViewportActive:n,viewportIndex:s,activeViewportIndex:r}=this.props;s!==r&&n(s)})}componentDidUpdate(n){const{displaySetInstanceUID:s}=n,{displaySetInstanceUID:r}=this.props;s!==r&&this.setContentFromByteArray(this.props.byteArray)}componentDidMount(){this.setContentFromByteArray(this.props.byteArray)}setContentFromByteArray(n){const s=n.buffer;try{const r=b.readFile(s),i=y.naturalizeDataset(r.dict);i._meta=y.namifyDataset(r.meta);const o=A(i),c=D("",i),u=a.createElement(a.Fragment,null,o,c);this.setState({content:u})}catch(r){r.message?this.setState({error:r.message}):this.setState({error:r})}}render(){const{content:n,error:s}=this.state;return a.createElement("div",{"data-cy":"dicom-html-viewport",className:"DicomHtmlViewport",onClick:this.setViewportActiveHandler,onScroll:this.setViewportActiveHandler},n,s&&a.createElement("h2",null,JSON.stringify(s)))}}p(v,"propTypes",{byteArray:E.uint8,setViewportActive:l.func.isRequired,viewportIndex:l.number.isRequired,activeViewportIndex:l.number.isRequired,displaySetInstanceUID:l.string});const{setViewportActive:V}=d.exports.redux.actions,C=(t,e)=>{const{viewportIndex:n,byteArray:s}=e,{activeViewportIndex:r}=t.viewer.viewports;return{viewportIndex:n,activeViewportIndex:r,byteArray:s}},$=(t,e)=>{const{viewportIndex:n}=e;return{setViewportActive:()=>{t(V(n))}}},M=w(C,$)(v),{DicomLoaderService:N}=d.exports.utils;class T extends h.exports.Component{constructor(){super(...arguments);p(this,"state",{byteArray:null,error:null,currentId:null,loading:!1});p(this,"fetchHtmlData",()=>{const{displaySet:{displaySetInstanceUID:n},studies:s}=this.props.viewportData,r=g(s,n);try{const i={Accept:"*/*"};r.authorizationHeaders=i,this.setState({loading:!0,error:null}),N.findDicomDataPromise(r,s).then(o=>this.setState({byteArray:new Uint8Array(o),currentId:r.displaySetInstanceUID,loading:!1}),o=>{this.setState({error:o})})}catch(i){this.setState({error:i})}})}componentDidMount(){this.fetchHtmlData()}componentDidUpdate(n){const{displaySet:s}=n.viewportData,{displaySet:r}=this.props.viewportData;s.displaySetInstanceUID!==r.displaySetInstanceUID&&this.fetchHtmlData()}render(){const{viewportIndex:n}=this.props,{byteArray:s,error:r,currentId:i,loading:o}=this.state,c=a.createElement("div",{className:"position-relative w-100 h-100",style:{zIndex:10}},a.createElement(x,{error:r}));return a.createElement(a.Fragment,null,s&&!o?a.createElement(M,{byteArray:s,viewportIndex:n,displaySetInstanceUID:i}):c,r&&a.createElement("h2",null,JSON.stringify(r)))}}p(T,"propTypes",{studies:l.object,displaySet:l.object,viewportIndex:l.number,viewportData:l.object});export{T as default};
