import{e,R as r,t as b,X as I,G as L,j as R,L as C}from"./index.dc3130ce.js";const O='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',U=(a,p={})=>{const{fragmented:o=!1}=p,[n]=e.exports.useState(null),c=e.exports.useRef(),[i,d]=e.exports.useState(r.createElement("video",{ref:c,autoPlay:!0,controls:!0})),[s,m]=e.exports.useState();return e.exports.useEffect(()=>{if(a&&a instanceof ArrayBuffer)if(o)c.current.src=URL.createObjectURL(s),s.addEventListener("sourceopen",()=>{window.vDebug.log("mediaSource source open");const t=s.addSourceBuffer(O);t.addEventListener("updateend",()=>{window.vDebug.log("handleAddSource updateend"),s.endOfStream()}),t.appendBuffer(a)});else{const t=new Blob([a]),l=URL.createObjectURL(t);d(r.createElement("video",{ref:c,src:l,autoPlay:!0,controls:!0}))}return()=>{}},[o,s,a]),e.exports.useEffect(()=>{if(o){const t=new MediaSource;m(t)}},[o]),[n,i]},{DicomLoaderService:A}=R.exports.utils,E={},P=a=>{const{viewportData:p}=a,{displaySet:o,studies:n}=p,[c,i]=e.exports.useState(!0),[d,s]=e.exports.useState(null),[m,t]=e.exports.useState(null),[l,x]=U(m,{fragmented:!1}),y=r.createElement("div",{className:"position-relative w-100 h-100",style:{zIndex:10}},r.createElement(C,{error:d})),g=e.exports.useCallback(()=>{const{displaySetInstanceUID:D}=o,f=b(n,D),{SOPInstanceUID:S}=f;if(E[S])t(E[S]),i(!1);else try{const v=localStorage.getItem(I),h={Authorization:`Basic ${btoa(v)}`};f.authorizationHeaders=h;const w={mediaTypes:["video/mp4"]};i(!0),s(null),A.findDicomDataPromise(f,n,w).then(u=>{E[S]=u,t(u),i(!1)},u=>{s(u)})}catch(v){s(v)}},[o,n]);return e.exports.useEffect(()=>{o&&n&&(t(null),g())},[g,o,n]),r.createElement(r.Fragment,null,c&&y,d&&r.createElement("h2",null,JSON.stringify(d)),l&&r.createElement("h2",null,JSON.stringify(l)),!c&&r.createElement("div",{className:"video-viewport"},x))};P.propTypes={viewportData:L.object};export{P as default};
